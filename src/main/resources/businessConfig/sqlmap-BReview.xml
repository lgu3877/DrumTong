<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC 	
		"-//mybatis.org//DTD Mapper 3.0//EN" 
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 사업장 메인리뷰 테이블	 -->
<mapper namespace="com.drumtong.business.dao.BReviewDAO">

	<select id="selectReviewNum" parameterType="hashmap" resultType="int">
		SELECT count(*) FROM BREVIEW WHERE ESTID=#{estid}
			<choose>
				<when test="division eq 'whole'.toString()">
					AND BLOCKBOOLEAN = 'N'
				</when>
				<when test="division eq 'noReply'.toString()">
					AND REPLYBOOLEAN = 'N' AND BLOCKBOOLEAN = 'N' 
				</when>
				<when test="division eq 'reportReply'.toString()">
					AND BLOCKBOOLEAN = 'Y'
				</when>
			</choose>
	</select>
	
	<select id="selectReview" parameterType="hashmap" resultType="com.drumtong.business.vo.ReviewList">
		SELECT P.NAME as customerName, A.* FROM CPRIVATEDATA P right outer join 
				(SELECT R.*, C.CONTENT as ccontent, C.REGISTDATE as cregistdate, 
							B.CONTENT as bcontent, B.REGISTDATE as bregistdate 
					FROM breview R 
					left outer join bcustomerreview C
					 on R.estid=#{estid} and R.estid=C.estid and R.memberid=C.memberid and R.salecode=C.salecode
  					left outer join bbusinessreview B
  					 on R.estid=B.estid and R.memberid=B.memberid and R.salecode=B.salecode
				<choose>
					<when test="division eq 'whole'.toString()">
						AND R.BLOCKBOOLEAN = 'N'
					</when>
					<when test="division eq 'noReply'.toString()">
						AND R.REPLYBOOLEAN = 'N' AND R.BLOCKBOOLEAN = 'N' 
					</when>
					<when test="division eq 'reportReply'.toString()">
						AND R.BLOCKBOOLEAN = 'Y'
					</when>
				</choose>
					ORDER BY R.SALECODE DESC) A
			on P.MEMBERID=A.MEMBERID
<!-- 		AND ROWNUM <![CDATA[>=]]> #{start} AND ROWNUM <![CDATA[<=]]> #{end} -->
	</select>
	
	<select id="selectNoReply" parameterType="String" resultType="BReviewVO">
		SELECT * FROM BREVIEW WHERE ESTID=#{estid} AND REPLYBOOLEAN='N'
	</select>
</mapper>
